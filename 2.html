<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Print-Only Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .upload-section {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-section:hover {
            background: #f8f9ff;
            border-color: #764ba2;
        }

        .upload-section input[type="file"] {
            display: none;
        }

        .upload-icon {
            font-size: 60px;
            color: #667eea;
            margin-bottom: 15px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .email-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        input[type="email"],
        input[type="date"],
        input[type="text"] {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 12px 25px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .email-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .email-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9ff;
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .email-item button {
            padding: 5px 15px;
            background: #ff4757;
            font-size: 0.9em;
        }

        .email-item button:hover {
            background: #ff3838;
        }

        .generate-btn {
            width: 100%;
            padding: 18px;
            font-size: 1.2em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .share-link-box {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .share-link-box h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .link-display {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .link-display input {
            background: white;
        }

        .pdf-viewer {
            border: 2px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 30px;
            background: #f5f5f5;
        }

        .pdf-toolbar {
            background: #333;
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #ddd;
        }

        .pdf-toolbar button {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #4caf50;
        }

        .pdf-toolbar button:hover {
            background: #45a049;
        }

        .pdf-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            background: #444;
            padding: 10px;
            justify-content: center;
        }

        .pdf-controls button {
            padding: 8px 15px;
            background: #667eea;
            font-size: 0.9em;
        }

        #pdf-canvas {
            display: block;
            margin: 20px auto;
            max-width: 100%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .page-info {
            color: white;
            font-size: 0.9em;
        }

        .info-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }

        .info-box h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .info-box ul {
            margin-left: 20px;
            color: #856404;
        }

        .info-box li {
            margin: 8px 0;
        }

        .success-msg {
            color: #4caf50;
            font-weight: 600;
            margin-top: 10px;
        }

        .hidden {
            display: none;
        }

        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 48px;
            color: rgba(0, 0, 0, 0.1);
            pointer-events: none;
            user-select: none;
        }

        .canvas-container {
            position: relative;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîí PDF Print-Only Secure Viewer</h1>
            <p>Upload, Share, and Control Access - Download Disabled, Print Enabled</p>
        </div>

        <div class="content">
            <!-- Upload Section -->
            <div class="section">
                <div class="section-title">üìÑ Step 1: Upload Your PDF</div>
                <label for="pdfUpload" class="upload-section">
                    <div class="upload-icon">üìÅ</div>
                    <h3>Click to Upload PDF</h3>
                    <p>PDF will render without download option</p>
                    <input type="file" id="pdfUpload" accept=".pdf">
                </label>
                <div id="uploadSuccess" class="success-msg hidden"></div>
            </div>

            <!-- Email Access Control -->
            <div class="section">
                <div class="section-title">üë• Step 2: Add Allowed Email Addresses (5-6 people)</div>
                <div class="email-input-group">
                    <input type="email" id="emailInput" placeholder="Enter email address (e.g., user@example.com)">
                    <button onclick="addEmail()">Add Email</button>
                </div>
                <div id="emailList" class="email-list"></div>
            </div>

            <!-- Expiration Date -->
            <div class="section">
                <div class="section-title">üìÖ Step 3: Set Expiration Date (Optional)</div>
                <input type="date" id="expiryDate" min="">
            </div>

            <!-- Generate Link -->
            <div class="section">
                <button class="generate-btn" onclick="generateLink()" id="generateBtn" disabled>
                    üîó Generate Secure Share Link
                </button>
            </div>

            <!-- Share Link Display -->
            <div id="shareLinkBox" class="share-link-box hidden">
                <h3>‚úÖ Secure Link Generated Successfully!</h3>
                <div class="link-display">
                    <input type="text" id="shareLink" readonly>
                    <button onclick="copyLink()">üìã Copy Link</button>
                </div>
                <p style="color: #2e7d32; font-size: 0.9em;">
                    ‚úì Only allowed email addresses can access<br>
                    ‚úì Download DISABLED (no download button in viewer)<br>
                    ‚úì Print ENABLED (use Print button below)<br>
                    <span id="expiryInfo"></span>
                </p>
            </div>

            <!-- PDF Viewer (Canvas-based, no download) -->
            <div id="pdfViewer" class="pdf-viewer hidden">
                <div class="pdf-toolbar">
                    <span style="font-weight: 600;">üìÑ PDF Preview (Download Disabled)</span>
                    <button onclick="printPDF()">
                        üñ®Ô∏è Print Document
                    </button>
                </div>
                <div class="pdf-controls">
                    <button onclick="previousPage()">‚¨ÖÔ∏è Previous</button>
                    <span class="page-info">
                        Page <span id="page-num">1</span> of <span id="page-count">0</span>
                    </span>
                    <button onclick="nextPage()">Next ‚û°Ô∏è</button>
                    <button onclick="zoomIn()">üîç Zoom In</button>
                    <button onclick="zoomOut()">üîç Zoom Out</button>
                </div>
                <div style="text-align: center; padding: 20px; overflow: auto; max-height: 800px;">
                    <div class="canvas-container">
                        <canvas id="pdf-canvas"></canvas>
                        <div class="watermark" id="watermark">PRINT ONLY</div>
                    </div>
                </div>
            </div>

            <!-- Important Information -->
            <div class="info-box">
                <h3>‚úÖ This Viewer PREVENTS Download:</h3>
                <ul>
                    <li><strong>‚úì No download button</strong> - PDF is rendered on canvas, not in browser's PDF viewer</li>
                    <li><strong>‚úì Right-click disabled</strong> - Cannot save image</li>
                    <li><strong>‚úì Print enabled</strong> - Click the Print button above</li>
                    <li><strong>‚úì Watermarked</strong> - "PRINT ONLY" watermark on display</li>
                    <li><strong>‚ö†Ô∏è Note:</strong> Users can still screenshot or print-to-PDF (unavoidable if print is enabled)</li>
                    <li><strong>Best for:</strong> Sharing with trusted people where convenience matters</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let pdfFile = null;
        let pdfDoc = null;
        let pageNum = 1;
        let pageRendering = false;
        let pageNumPending = null;
        let scale = 1.5;
        let allowedEmails = [];
        const canvas = document.getElementById('pdf-canvas');
        const ctx = canvas.getContext('2d');

        // Set minimum date to today
        document.getElementById('expiryDate').min = new Date().toISOString().split('T')[0];

        // Handle file upload
        document.getElementById('pdfUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type === 'application/pdf') {
                pdfFile = file;
                
                // Show success message
                const successMsg = document.getElementById('uploadSuccess');
                successMsg.textContent = `‚úì ${file.name} uploaded successfully! (Download disabled)`;
                successMsg.classList.remove('hidden');
                
                // Load and render PDF
                loadPDF(file);
                
                checkGenerateButton();
            } else {
                alert('‚ùå Please upload a valid PDF file');
            }
        });

        // Load PDF using PDF.js
        function loadPDF(file) {
            const fileReader = new FileReader();
            fileReader.onload = function() {
                const typedarray = new Uint8Array(this.result);
                
                pdfjsLib.getDocument(typedarray).promise.then(function(pdf) {
                    pdfDoc = pdf;
                    document.getElementById('page-count').textContent = pdf.numPages;
                    document.getElementById('pdfViewer').classList.remove('hidden');
                    renderPage(pageNum);
                });
            };
            fileReader.readAsArrayBuffer(file);
        }

        // Render specific page
        function renderPage(num) {
            pageRendering = true;
            pdfDoc.getPage(num).then(function(page) {
                const viewport = page.getViewport({scale: scale});
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };

                const renderTask = page.render(renderContext);
                renderTask.promise.then(function() {
                    pageRendering = false;
                    if (pageNumPending !== null) {
                        renderPage(pageNumPending);
                        pageNumPending = null;
                    }
                });
            });

            document.getElementById('page-num').textContent = num;
        }

        // Queue page rendering
        function queueRenderPage(num) {
            if (pageRendering) {
                pageNumPending = num;
            } else {
                renderPage(num);
            }
        }

        // Navigation functions
        function previousPage() {
            if (pageNum <= 1) return;
            pageNum--;
            queueRenderPage(pageNum);
        }

        function nextPage() {
            if (pageNum >= pdfDoc.numPages) return;
            pageNum++;
            queueRenderPage(pageNum);
        }

        function zoomIn() {
            scale += 0.2;
            queueRenderPage(pageNum);
        }

        function zoomOut() {
            if (scale <= 0.5) return;
            scale -= 0.2;
            queueRenderPage(pageNum);
        }

        // Print function
        function printPDF() {
            if (!pdfDoc) {
                alert('Please upload a PDF first');
                return;
            }
            
            // Create a new window with all pages rendered for printing
            const printWindow = window.open('', '_blank');
            printWindow.document.write('<html><head><title>Print PDF</title></head><body style="margin:0;padding:20px;">');
            
            let promises = [];
            for (let i = 1; i <= pdfDoc.numPages; i++) {
                promises.push(
                    pdfDoc.getPage(i).then(function(page) {
                        const viewport = page.getViewport({scale: 1.5});
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;

                        return page.render({
                            canvasContext: context,
                            viewport: viewport
                        }).promise.then(function() {
                            return canvas.toDataURL();
                        });
                    })
                );
            }

            Promise.all(promises).then(function(images) {
                images.forEach(function(imgData) {
                    printWindow.document.write('<img src="' + imgData + '" style="max-width:100%; page-break-after:always;"><br>');
                });
                printWindow.document.write('</body></html>');
                printWindow.document.close();
                
                setTimeout(function() {
                    printWindow.print();
                }, 500);
            });
        }

        // Disable right-click on canvas
        canvas.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            alert('‚ùå Right-click is disabled. Use the Print button to print.');
            return false;
        });

        // Add email to list
        function addEmail() {
            const emailInput = document.getElementById('emailInput');
            const email = emailInput.value.trim();
            
            if (email && email.includes('@') && email.includes('.')) {
                if (!allowedEmails.includes(email)) {
                    allowedEmails.push(email);
                    updateEmailList();
                    emailInput.value = '';
                    checkGenerateButton();
                } else {
                    alert('‚ö†Ô∏è This email is already added');
                }
            } else {
                alert('‚ùå Please enter a valid email address');
            }
        }

        // Update email list display
        function updateEmailList() {
            const emailList = document.getElementById('emailList');
            emailList.innerHTML = '';
            
            allowedEmails.forEach((email, index) => {
                const emailItem = document.createElement('div');
                emailItem.className = 'email-item';
                emailItem.innerHTML = `
                    <span>üìß ${email}</span>
                    <button onclick="removeEmail(${index})">Remove</button>
                `;
                emailList.appendChild(emailItem);
            });
        }

        // Remove email from list
        function removeEmail(index) {
            allowedEmails.splice(index, 1);
            updateEmailList();
            checkGenerateButton();
        }

        // Check if generate button should be enabled
        function checkGenerateButton() {
            const btn = document.getElementById('generateBtn');
            btn.disabled = !(pdfFile && allowedEmails.length > 0);
        }

        // Generate share link
        function generateLink() {
            const randomId = Math.random().toString(36).substr(2, 9);
            const shareLink = `https://sam411042.github.io/Bible-College-2026/1.html?id=${randomId}`;
            
            document.getElementById('shareLink').value = shareLink;
            document.getElementById('shareLinkBox').classList.remove('hidden');
            
            // Show expiry info if set
            const expiryDate = document.getElementById('expiryDate').value;
            const expiryInfo = document.getElementById('expiryInfo');
            if (expiryDate) {
                expiryInfo.textContent = `‚úì Link expires on: ${new Date(expiryDate).toLocaleDateString()}`;
            } else {
                expiryInfo.textContent = '';
            }

            alert('‚úÖ Secure link generated! This viewer prevents downloading.');
        }

        // Copy link to clipboard
        function copyLink() {
            const linkInput = document.getElementById('shareLink');
            linkInput.select();
            document.execCommand('copy');
            alert('‚úÖ Link copied to clipboard!');
        }

        // Allow Enter key to add email
        document.getElementById('emailInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addEmail();
            }
        });

        // Disable keyboard shortcuts for saving
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                alert('‚ùå Download is disabled. You can only print this document.');
                return false;
            }
        });
    </script>
</body>
</html>